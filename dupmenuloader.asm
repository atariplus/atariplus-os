10 ; DUP - LOADER (C) 1990 THOR INC.
20       .OPT OBJ
30       *=  $0600
40       .SET 6,$3000
50       JMP START
60       JMP INIT
70 RELS  .WORD $33E8
80 RELE  .WORD $33E8
90 PROGBASE = $F0
100 PROGSTART = $F2
110 RELOSTART = $F4
120 RELOMSK = $F6
130 OFFSET = $F8
140 START
150      LDY $02E8
160      LDX $02E7
170      BEQ NNX
180      INY 
190 NNX  LDX #$6E
200      TYA 
210      CLC 
220      ADC #$03
230      AND #$FC
240      STX PROGBASE
250      CLC 
260      ADC #$05
270      STA OFFSET
280      STA PROGBASE+1
290      STA JA+2
300      LDX #$6E
310      LDY #$25
320      STX PROGSTART
330      STY PROGSTART+1
340      LDX RELS
350      LDY RELS+1
360      STX RELOSTART
370      STY RELOSTART+1
380      LDX #$80
390      STX RELOMSK
400      LDY #$00
410 RELOP
420      JSR GETBYTE
430      BCS EOF
440      PHA 
450      LDA (RELOSTART),Y
460      AND RELOMSK
470      BEQ NORELO
480      PLA 
490      CLC 
500      ADC OFFSET
510      PHA 
520 NORELO
530      PLA 
540      STA (PROGBASE),Y
550      INC PROGBASE
560      BNE I1
570      INC PROGBASE+1
580 I1   LSR RELOMSK
590      BCC RELOP
600      ROR RELOMSK
610      INC RELOSTART
620      BNE RELOP
630      INC RELOSTART+1
640      BNE RELOP
650 EOF
660 JA   JMP $FF72
670 GETBYTE
680      LDA PROGSTART
690      CMP RELE
700      LDA PROGSTART+1
710      SBC RELE+1
720      BCS GETRETOF
730      LDA (PROGSTART),Y
740      INC PROGSTART
750      BNE I2
760      INC PROGSTART+1
770 I2   CLC 
780 GETRETOF RTS 
790 INIT
800      LDX #$00
810      LDA #$0B
820      STX 752
830      STX $52
840      INC $52
850      STA $0342,X
860      LDA # <TXT
870      STA $0344,X
880      LDA # >TXT
890      STA $0345,X
900      LDA # <TXTL
910      STA $0348,X
920      LDA # >TXTL
930      STA $0349,X
940      JSR $E456
950      RTS 
960 TXT
970      .BYTE "}Please wait for loading DUP menu ....."
980 TXTL =   *-TXT
